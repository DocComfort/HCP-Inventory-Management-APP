# Netlify Build Configuration
[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"

# Allow VITE_* vars in build output (they're public keys, not secrets)
# These are Supabase public/anon keys that are safe to expose
[build.processing.skip_processing]
  secrets_scan = false

# Tell secrets scanner these keys are safe to expose
SECRETS_SCAN_OMIT_KEYS = "VITE_SUPABASE_URL,VITE_SUPABASE_KEY,VITE_SUPABASE_ANON_KEY,VITE_API_BASE_URL"

# Redirect all requests to index.html for SPA routing (except functions)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  conditions = {Role = ["*"]}
  force = false

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Headers for static assets (cache for 1 year)
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Note: Environment variables to set in Netlify Dashboard:
# - VITE_API_BASE_URL (Railway backend URL)
# - VITE_SUPABASE_URL (Supabase project URL)
# - VITE_SUPABASE_ANON_KEY (Supabase anon key - safe to expose)
# - INTEGRATIONS_KEY (Secret key for Netlify Functions - NOT exposed to frontend)


# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer"
    X-XSS-Protection = "1; mode=block"
